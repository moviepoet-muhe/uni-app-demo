"use strict";const common_vendor=require("../../common/vendor.js");const store_cart=require("../../store/cart.js");const api_category=require("../../api/category.js");const api_home=require("../../api/home.js");const _sfc_main={data(){return{categories:[],banners:[],recommends:[],nextIndex:0,isEnd:false}},async onLoad(){try{const res=await Promise.all([api_category.getAllCategories(),api_home.getHomeData()]);console.log("res:::",res);this.categories=res[0].list;this.banners=res[1].banners;this.recommends=res[1].items.list;this.nextIndex=res[1].items.nextIndex;this.isEnd=res[1].items.isEnd}catch(error){console.error("error:",error)}},onPullDownRefresh(){console.log("下拉刷新效果...")},async onReachBottom(){if(this.isEnd){console.log("全部数据查询完毕");return}try{const res=await api_home.getMore(this.nextIndex);this.recommends=this.recommends.concat(res.list);this.nextIndex=res.nextIndex;this.isEnd=res.isEnd}catch(error){console.log("查询数据异常:::",error)}},methods:{...common_vendor.mapActions(store_cart.useCartStore,{addToCart:"addToCart",remove:"removeFromCart"}),jumpToDetail(id){common_vendor.index.navigateTo({url:"/pages/detail/detail?id="+id})},jumpToCategory(id){getApp().globalData.categoryId=id;common_vendor.index.switchTab({url:"/pages/category/category"})},handleAddToCart(goods){const{id:id,title:title,price:price,image:image}=goods;const currGoods={id:id,title:title,price:price,image:image,amount:1};this.addToCart(currGoods);common_vendor.index.showToast({title:"加入购物车成功!",duration:2e3})}}};if(!Array){const _easycom_uni_search_bar2=common_vendor.resolveComponent("uni-search-bar");_easycom_uni_search_bar2()}const _easycom_uni_search_bar=()=>"../../uni_modules/uni-search-bar/components/uni-search-bar/uni-search-bar.js";if(!Math){_easycom_uni_search_bar()}function _sfc_render(_ctx,_cache,$props,$setup,$data,$options){return common_vendor.e({a:common_vendor.p({placeholder:"请输入搜索关键字",["cancel-text"]:"登录",cancelButton:"always"}),b:common_vendor.f($data.categories,((category,k0,i0)=>({a:common_vendor.t(category.name),b:category.id,c:common_vendor.o(($event=>$options.jumpToCategory(category.id)))}))),c:common_vendor.f($data.banners,((banner,k0,i0)=>({a:banner.image,b:banner.id}))),d:common_vendor.f($data.recommends,((goods,k0,i0)=>({a:goods.image,b:common_vendor.o(($event=>$options.jumpToDetail(goods.id))),c:common_vendor.t(goods.title),d:"/pages/detail/detail?id="+goods.id,e:common_vendor.t(goods.price),f:common_vendor.o(($event=>$options.handleAddToCart(goods))),g:goods.id}))),e:!$data.isEnd},!$data.isEnd?{}:{})}const MiniProgramPage=common_vendor._export_sfc(_sfc_main,[["render",_sfc_render],["__scopeId","data-v-1923443a"]]);my.createPage(MiniProgramPage);
